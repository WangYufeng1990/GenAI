<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DeepSeek R1 æœ¬åœ°åŠ©æ‰‹</title>
    <style>
        :root { --primary-color: #007bff; --bg-color: #f4f7f6; --chat-bg: #ffffff; }
        body { font-family: 'PingFang SC', sans-serif; background-color: var(--bg-color); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }

        /* èŠå¤©å®¹å™¨ */
        #chat-container { width: 90%; max-width: 600px; height: 85vh; background: var(--chat-bg); border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
        #header { padding: 15px; background: var(--primary-color); color: white; text-align: center; font-weight: bold; }

        /* æ¶ˆæ¯åŒºåŸŸ */
        #chat-window { flex: 1; padding: 20px; overflow-y: auto; border-bottom: 1px solid #eee; }
        .message { margin-bottom: 15px; display: flex; }
        .message-content { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 0.95rem; line-height: 1.5; word-wrap: break-word; }
        .user-message { justify-content: flex-end; }
        .user-message .message-content { background-color: var(--primary-color); color: white; }
        .ai-message { justify-content: flex-start; }
        .ai-message .message-content { background-color: #e9ecef; color: #333; }

        /* æ€è€ƒè¿‡ç¨‹æ ·å¼ */
        .thought-process {
            color: #888;
            font-style: italic;
            background-color: #f8f9fa;
            border-left: 3px solid #007bff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 0.85rem;
            display: block;
        }
        hr { border: none; border-top: 1px dashed #ccc; margin: 10px 0; }

        /* è¾“å…¥åŒºåŸŸ */
        #input-area { padding: 15px; display: flex; gap: 10px; }
        #user-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        #send-btn { padding: 0 20px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="header">DeepSeek R1 æ™ºèƒ½å¯¹è¯</div>
    <div id="chat-window"></div>
    <div id="input-area">
        <input type="text" id="user-input" placeholder="è¾“å…¥é—®é¢˜ï¼ˆæ”¯æŒ 14B æ€è€ƒè¿‡ç¨‹ï¼‰..." autocomplete="off">
        <button id="send-btn">å‘é€</button>
    </div>
</div>

<script>
    // ç¡®ä¿ DOM å…ƒç´ åœ¨è„šæœ¬è¿è¡Œå‰å·²å­˜åœ¨
    const chatWindow = document.getElementById('chat-window');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const chatId = "session_" + Math.random().toString(36).substring(7);

    function appendMessage(role) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${role}-message`;
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        msgDiv.appendChild(contentDiv);
        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        return contentDiv;
    }

    function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        // ç”¨æˆ·æ¶ˆæ¯
        const userDiv = appendMessage('user');
        userDiv.innerText = message;
        userInput.value = '';

        // AI æ¶ˆæ¯åˆå§‹åŒ–
        const aiContentDiv = appendMessage('ai');
        sendBtn.disabled = true;

        const source = new EventSource(`/stream?message=${encodeURIComponent(message)}&chatId=${chatId}`);
        let fullContent = "";

        source.onmessage = function(event) {
            fullContent += event.data;

            // å¤„ç†æ€è€ƒè¿‡ç¨‹æ ‡ç­¾ï¼šå…ˆè½¬ä¹‰ï¼Œå†æ›¿æ¢ä¸º HTML
            let displayHTML = fullContent
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/&lt;think&gt;/g, "<div class='thought-process'><strong>ğŸ¤” æ€è€ƒä¸­...</strong><br>")
                .replace(/&lt;\/think&gt;/g, "</div><hr>")
                .replace(/\n/g, "<br>");

            aiContentDiv.innerHTML = displayHTML;
            chatWindow.scrollTop = chatWindow.scrollHeight;
        };

        source.onerror = function() {
            source.close();
            sendBtn.disabled = false;
        };
    }

    // äº‹ä»¶ç»‘å®š
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>

</body>
</html>